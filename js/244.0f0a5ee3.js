"use strict";(self["webpackChunkdbdiagram"]=self["webpackChunkdbdiagram"]||[]).push([[244],{6244:(e,t,a)=>{a.r(t),a.d(t,{default:()=>gt});var l=a(9835),n=a(499);const i={ref:"root",class:"dbml-editor-wrapper"};function o(e,t,a,n,o,s){const r=(0,l.up)("v-ace-editor");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l.Wm)(r,{class:"dbml-editor",lang:"dbml",theme:n.theme,value:n.sourceCode,"onUpdate:value":t[0]||(t[0]=e=>n.sourceCode=e),"print-margin":!1,options:n.options,onInit:n.editorInit},null,8,["theme","value","options","onInit"])],512)}var s=a(171),r=a(5424),d=a(9684);class u{constructor(e,t){this.session=e,this.info=t,this.type=t.type,this.row=t.row,this.text=t.text||t.message||void 0,this.startAnchor=e.getDocument().createAnchor(t.row,t.column),this.endAnchor=e.getDocument().createAnchor(t.endRow||t.row,t.endColumn),this.startAnchor.on("change",this.update.bind(this)),this.endAnchor.on("change",this.update.bind(this)),this.marker=null,this.update()}update(){console.log("update",this);const e=d.Range.fromPoints(this.startAnchor.getPosition(),this.endAnchor.getPosition());this.marker&&this.session.removeMarker(this.marker),this.marker=this.session.addMarker(e,`marker-highlight-${this.info.type}`,"text")}remove(){this.startAnchor.detach(),this.endAnchor.detach(),this.marker&&this.session.removeMarker(this.marker)}}const c={name:"DbmlEditor",components:{VAceEditor:s.m},props:["source"],setup(e,{emit:t}){let a=null;const i=(0,r.E)(),o=(0,n.iH)({markerId:null,errorMarkerId:null}),s=(0,n.qj)([]),c=(0,l.Fl)({get:()=>e.source,set:e=>t("update:source",e)}),h=(0,l.Fl)({get:()=>i.getTheme,set:e=>i.updateTheme(e)}),v=(e,t)=>{o.value.markerId&&(a.session.removeMarker(o.value.markerId),o.value.markerId=null);const l=new d.Range(e.row-1,e.col-1,t.row-1,t.col-1);a.focus(),a.clearSelection(),a.scrollToLine(e.row-1),a.moveCursorTo(e.row-1,e.col-1),o.value.markerId=a.session.addMarker(l,"ace_active-line","text"),console.log("highlightTokenRange",o.value.markerId,e,t)},p=e=>{a=e},m=(0,n.iH)({useWorker:!1,tabSize:2,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,showPrintMargin:!1}),g=i.$subscribe(((e,t)=>{if("editor"===e.storeId&&e.payload){if(e.payload.source&&e.payload.source.markers&&e.payload.source.markers.selection){const e=i.source.markers.selection,t=e.start,a=e.end;v({row:t.line,col:t.column},{row:a.line,col:a.column})}if("parserError"in e.payload){for(const e of s)e.remove();if(a.session.clearAnnotations(),o.value.errorMarkerId&&(a.session.removeMarker(o.value.errorMarkerId),o.value.errorMarkerId=null),e.payload.parserError){const e=t.parserError,l=[new u(a.session,{text:e.message,type:e.type,row:e.location.start.row,column:e.location.start.col,endRow:e.location.end.row,endColumn:e.location.end.col})];s.push(...l),a.session.setAnnotations(l)}}}}));return{currentMarkerRef:o,sourceCode:c,theme:h,options:m,highlightTokenRange:v,editorInit:p,subscription:g}}};var h=a(1639);const v=(0,h.Z)(c,[["render",o],["__scopeId","data-v-bf861e52"]]),p=v;var m=a(6970);const g=["id","x","y","width","height"],b=["height","width"],f=["y"],y=["x","y"],x={props:{id:Number,selection:String,token:Object,name:String,type:Object,unique:Boolean,pk:Boolean,dbState:Object,not_null:Boolean,note:String,dbdefault:Object,increment:Boolean,width:Number,table:Object,endpoints:Array,_enum:Object},setup(e){const t=e,a=(0,n.iH)(null),i=(0,l.Fl)((()=>({width:t.width,height:30}))),o=(0,l.Fl)((()=>({x:0,y:35+30*t.table.fields.findIndex((e=>e.id===t.id))}))),s=((0,l.bv)((()=>{})),(0,n.iH)(!1)),r=(0,n.iH)(!1),d=e=>{s.value=!0},u=e=>{s.value=!1,r.value=!1},c=e=>{r.value=!1},h=e=>{r.value=!0};return(t,v)=>((0,l.wg)(),(0,l.iD)("svg",{ref_key:"root",ref:a,id:`field-${e.id}`,class:(0,m.C_)({"db-field":!0,"db-field__highlight":s.value,"db-field__dragging":r.value,"db-field__pk":e.pk,"db-field__unique":e.unique,"db-field__not_null":e.not_null,"db-field__increment":e.increment,"db-field__ref":e.endpoints.length>0}),x:(0,n.SU)(o).x,y:(0,n.SU)(o).y,width:(0,n.SU)(i).width,height:(0,n.SU)(i).height,onMousedownPassive:h,onMouseupPassive:c,onMouseenterPassive:d,onMouseleavePassive:u},[(0,l._)("rect",{height:(0,n.SU)(i).height,width:(0,n.SU)(i).width},null,8,b),(0,l._)("text",{class:"db-field__name",y:(0,n.SU)(i).height/2},(0,m.zw)(e.name),9,f),(0,l._)("text",{class:"db-field__type",x:(0,n.SU)(i).width,y:(0,n.SU)(i).height/2},(0,m.zw)(e.type.type_name),9,y),(0,l._)("title",null,(0,m.zw)(e.name)+" ("+(0,m.zw)(e.type.type_name)+")",1)],42,g))}},_=x,w=_,S={class:"text-subtitle2"},k=(0,l._)("div",{class:"text-caption"},"Indexes",-1),U={props:{table:Object},setup(e){return(t,a)=>{const n=(0,l.up)("q-card-section"),i=(0,l.up)("q-separator"),o=(0,l.up)("q-item-label"),s=(0,l.up)("q-item"),r=(0,l.up)("q-list");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(n,null,{default:(0,l.w5)((()=>[(0,l._)("div",S,(0,m.zw)(e.table.name),1)])),_:1}),(0,l.Wm)(i),(0,l.Wm)(n,null,{default:(0,l.w5)((()=>[k,(0,l.Wm)(r,null,{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.table.indexes,(e=>((0,l.wg)(),(0,l.j4)(s,null,{default:(0,l.w5)((()=>[(0,l.Wm)(o,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,m.zw)(e.name),1)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1})],64)}}};var M=a(3190),P=a(926),C=a(3246),q=a(490),D=a(3115),j=a(9984),H=a.n(j);const $=U,R=$;H()(U,"components",{QCardSection:M.Z,QSeparator:P.Z,QList:C.Z,QItem:q.Z,QItemLabel:D.Z});var E=a(1474);function N(e,t){return Math.round(e/t)*t}function O(e,t){return console.log("snap",e,t),"number"===typeof e?N(e,t):"x"in e&&"y"in e?(e.x=N(e.x),e.y=N(e.y),e):e}const L=["id","x","y","width","height"],z=["width","height"],A=["width","fill"],Y={class:"db-table-header__name",y:"16"},T={class:"db-table-fields"},I={props:{id:Number,selection:String,token:Object,group:Object,name:String,alias:String,note:String,indexes:Array,schema:Object,headerColor:{type:String,default:()=>""},dbState:Object,fields:{type:Array,default:()=>[]},containerRef:Object},emits:["update:position","click:header","click:field"],setup(e,{emit:t}){const a=e,i=(0,r.E)(),o=(0,E.g)(),s=(0,l.Fl)((()=>o.getTable(a.id))),d=(0,n.iH)(null),u=()=>{if(!d.value)return;const e=[...d.value.querySelectorAll(".db-field")],t=e.map((e=>[...e.querySelectorAll("text")].map((e=>e.getComputedTextLength())).reduce(((e,t)=>e+t),48))).reduce(((e,t)=>Math.max(e,t)),0);s.value.width=O(Math.max(200,t),f)},c=()=>{s.value.height=35+30*a.fields.length};(0,l.YP)((()=>a.fields),(e=>{c(),u()})),(0,l.bv)((()=>{c(),u()}));(0,l.Fl)((()=>({width:200,height:35+30*a.fields.length})));const h=(0,n.iH)(!1),v=((0,n.iH)(!1),(0,n.iH)(!1)),p=(0,n.iH)(null),g=(0,n.iH)(null),b=(0,n.iH)(null),f=(o.subGridSize,o.grid.snap),y=e=>{h.value=!0},x=e=>{h.value=!1,v.value=!1},_=({offsetX:e,offsetY:a})=>{const l=o.inverseCtm.transformPoint({x:e,y:a});s.value.x=O(l.x-p.value,f),s.value.y=O(l.y-g.value,f),t("update:position",s.value)},S=e=>{v.value=!1,h.value=!1,p.value=null,g.value=null,a.containerRef.removeEventListener("mousemove",_,{passive:!0}),a.containerRef.removeEventListener("mouseup",S,{passive:!0}),a.containerRef.removeEventListener("mouseleave",x,{passive:!0})},k=({offsetX:e,offsetY:t})=>{v.value=!0;const l=o.inverseCtm.transformPoint({x:e,y:t});p.value=l.x-s.value.x,g.value=l.y-s.value.y,b.value=a.containerRef.createSVGPoint(),a.containerRef.addEventListener("mousemove",_,{passive:!0}),a.containerRef.addEventListener("mouseup",S,{passive:!0}),a.containerRef.addEventListener("mouseleave",x,{passive:!0})},U=()=>{const e={x:s.value.x+s.value.width,y:s.value.y};o.showTooltip(e,R,{table:a})},M=()=>{o.hideTooltip()};function P(e){t("click:header",e,i.findTable(a.id))}function C(e,a){t("click:field",e,a)}return(t,a)=>((0,l.wg)(),(0,l.iD)("svg",{ref_key:"root",ref:d,id:`table-${e.id}`,class:(0,m.C_)({"db-table":!0,"db-table__highlight":h.value,"db-table__dragging":v.value}),x:(0,n.SU)(s).x,y:(0,n.SU)(s).y,width:(0,n.SU)(s).width,height:(0,n.SU)(s).height,onMouseenterPassive:y,onMouseleavePassive:x},[(0,l._)("rect",{class:"db-table__background",width:(0,n.SU)(s).width,height:(0,n.SU)(s).height},null,8,z),(0,l._)("g",{class:"db-table-header",onMousedownPassive:k,onMouseenterPassive:U,onMouseleavePassive:M},[(0,l._)("rect",{height:"35",width:(0,n.SU)(s).width,fill:e.headerColor,onClickPassive:P},null,40,A),(0,l._)("text",Y,(0,m.zw)(e.name),1),(0,l._)("title",null,(0,m.zw)(e.name),1)],32),(0,l._)("g",T,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.fields,(e=>((0,l.wg)(),(0,l.j4)((0,n.SU)(w),(0,l.dG)(e,{key:e.id,width:(0,n.SU)(s).width,onClickPassive:t=>C(t,e)}),null,16,["width","onClickPassive"])))),128))])],42,L))}},Z=I,W=Z,F=["id"],G=["d"],B=["d"],Q={class:"db-ref__control-points"},V=["cx","cy","data-id"],X={props:{id:Number,name:String,endpoints:Array,onUpdate:[String,Object,void 0],onDelete:[String,Object,void 0],schema:Object,dbState:Object,database:Object,token:Object,containerRef:Object},setup(e){const t=e,a=(0,E.g)();let i=a.getRef(t.id);a.subGridSize;const o=a.grid.snap,s=(0,n.iH)(!1),r=(0,n.iH)([]),d=((0,n.iH)(""),e=>{const t=a.getTable(e.fields[0].table.id),l=e.fields[0].table.fields.findIndex((t=>t.id===e.fields[0].id));return[{x:t.x,y:t.y+35+30*l+15},{x:t.x+t.width,y:t.y+35+30*l+15}]}),u=(e,t)=>{const a=t.map((t=>({distanceXY:{x:t.x-e.x,y:t.y-e.y},distance:Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),anchor:t})));let l=a[0];for(const n of a)n.distance<l.distance&&(l=n);return l.anchor},c=(e,t)=>{const a=e.flatMap((e=>t.map((t=>({distanceXY:{x:e.x-t.x,y:e.y-t.y},distance:Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)),a:e,b:t})))));let l=a[0];for(const n of a)n.distance<l.distance&&(l=n);return[l.a,l.b]},h=(0,l.Fl)((()=>d(t.endpoints[0]))),v=(0,l.Fl)((()=>d(t.endpoints[1]))),p=(0,l.Fl)((()=>(i.vertices.length&&!i.vertices.some((e=>Number.isNaN(e.x)||Number.isNaN(e.y)))||g(),!i.vertices.length||i.vertices.some((e=>Number.isNaN(e.x)||Number.isNaN(e.y)))?[]:i.vertices))),g=()=>{const e=h.value,t=v.value;if(!i.vertices.length||i.vertices.some((e=>Number.isNaN(e.x)||Number.isNaN(e.y))))i.auto=!0;else if(!i.auto)return;const[a,l]=c(e,t);console.log("updateControlPoints",a,l,e,t);const n=Math.min(a.x,l.x),o=Math.min(a.y,l.y),s=Math.max(a.x,l.x),r=Math.max(a.y,l.y),d=n+(s-n||2)/2,u=o+(r-o||2)/2,p={x:d,y:u};i.vertices=[{x:p.x,y:a.y},{x:p.x,y:l.y}]},b=(0,l.Fl)((()=>{const e=h.value,t=v.value,a=i.vertices;if(0==a.length||a.some((e=>Number.isNaN(e.x)||Number.isNaN(e.y))))return"";const l=u(a[0],e),n=u(a[a.length-1],t);return`M ${l.x},${l.y} L ${a.map((e=>`${e.x},${e.y}`)).join(" ")} L ${n.x} ${n.y}`})),f=e=>{s.value=!0},y=e=>{s.value=!1},x=(0,n.iH)(null),_=(0,n.iH)(null),w=(0,n.qj)({x:0,y:0}),S=({target:e})=>{const t=Number(e.getAttribute("data-id"));x.value=t},k=({target:e})=>{x.value=null,x.value=null},U=({target:e,offsetX:l,offsetY:n})=>{const o=Number(e.getAttribute("data-id")),s=i.vertices[o];_.value=o;const r=a.inverseCtm.transformPoint({x:l,y:n});w.x=r.x-s.x,w.y=r.y-s.y,t.containerRef.addEventListener("mousemove",M,{passive:!0}),t.containerRef.addEventListener("mouseup",P,{passive:!0}),t.containerRef.addEventListener("mouseleave",k,{passive:!0})},M=({target:e,offsetX:t,offsetY:l})=>{const n=a.inverseCtm.transformPoint({x:t,y:l}),s=_.value;i.auto&&(i.auto=!1);const r=i.vertices[s];r.x=O(n.x-w.x,o),r.y=O(n.y-w.y,o)},P=e=>{w.x=0,w.y=0,_.value=null,x.value=null,t.containerRef.removeEventListener("mousemove",M,{passive:!0}),t.containerRef.removeEventListener("mouseup",P,{passive:!0}),t.containerRef.removeEventListener("mouseleave",k,{passive:!0})},C=({target:e})=>{i.auto=!0,g()};return(0,l.bv)((()=>{r.value=t.endpoints.map((e=>a.getTable(e.fields[0].table.id))),(0,l.Y3)((()=>{g()}))})),(0,l.YP)((()=>t.id),(e=>{i=a.getRef(e)})),(0,l.YP)(t.endpoints,(()=>{r.value=t.endpoints.map((e=>a.getTable(e.fields[0].table.id)))}),{deep:!0}),(0,l.YP)(r,(()=>{g()}),{deep:!0}),(t,a)=>((0,l.wg)(),(0,l.iD)("g",{ref:"root",id:`ref-${e.id}`,class:(0,m.C_)({"db-ref":!0,"db-ref__highlight":s.value}),onMouseenterPassive:f,onMouseleavePassive:y},[(0,l._)("path",{class:"db-ref__hitbox",d:(0,n.SU)(b)},null,8,G),(0,l._)("path",{class:"db-ref__path",d:(0,n.SU)(b)},null,8,B),(0,l._)("g",Q,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,n.SU)(p),((e,t)=>((0,l.wg)(),(0,l.iD)("circle",{key:t,cx:e.x,cy:e.y,class:(0,m.C_)({"db-ref__control-point":!0,"db-ref__control-point__highlight":t===x.value,"db-ref__control-point__dragging":t===_.value}),"data-id":t,onDblclickPassive:C,onMousedownPassive:U,onMouseenterPassive:S,onMouseleavePassive:k},null,42,V)))),128))])],42,F))}},K=X,J=K;var ee=a(6397),te=a.n(ee);const ae=["x","y"],le={x:"0",y:"0",width:"100%",height:"100%",class:"db-tooltip__content"},ne={setup(e){const t=(0,E.g)(),a=(0,l.Fl)((()=>t.tooltip));return(e,t)=>{const i=(0,l.up)("q-card");return(0,n.SU)(a).show?((0,l.wg)(),(0,l.iD)("svg",{key:0,x:(0,n.SU)(a).x,y:(0,n.SU)(a).y,class:"db-tooltip"},[((0,l.wg)(),(0,l.iD)("foreignObject",le,[(0,l.Wm)(i,{class:"db-tooltip__content-card"},{default:(0,l.w5)((()=>[((0,l.wg)(),(0,l.j4)((0,l.LL)((0,n.SU)(a).component),(0,m.vs)((0,l.F4)((0,n.SU)(a).binds)),null,16))])),_:1})]))],8,ae)):(0,l.kq)("",!0)}}};var ie=a(4458);const oe=ne,se=oe;H()(ne,"components",{QCard:ie.Z});const re=["id","x","y","width","height"],de=["width","height"],ue=["width"],ce={class:"db-tablegroup-header__name",y:"16"},he=["x2"],ve={props:{name:String,tables:Array,schema:Object,dbState:Object,id:Number,containerRef:Object},setup(e){const t=e,a=(0,E.g)(),i=(0,l.Fl)((()=>a.getTableGroup(t.id))),o=(0,n.iH)(null),s=(0,n.iH)([]),r=()=>{const e=t.tables.map((e=>a.getTable(e.id)));console.log(e);const l=e.reduce(((e,t)=>e?Math.min(e,t.x):t.x),0),n=e.reduce(((e,t)=>e?Math.max(e,t.x+t.width):t.x+t.width),0),o=e.reduce(((e,t)=>e?Math.min(e,t.y):t.y),0),s=e.reduce(((e,t)=>e?Math.max(e,t.y+t.height):t.y+t.height),0);console.log(l,n,o,s),i.value.x=l-20,i.value.y=o-20-35,i.value.width=Math.abs(n-l)+40,i.value.height=Math.abs(s-o)+40+35};(0,l.YP)((()=>t.tables),(e=>{s.value=t.tables.map((e=>a.getTable(e.id))),r()}),{deep:!0}),(0,l.bv)((()=>{s.value=t.tables.map((e=>a.getTable(e.id))),r()})),(0,l.YP)(s,(()=>{r()}),{deep:!0});const d=(0,n.iH)(!1),u=(0,n.iH)(!1),c=(0,n.iH)(null),h=(a.subGridSize,a.grid.snap),v=e=>{d.value=!0},p=e=>{d.value=!1,u.value=!1},g=({offsetX:e,offsetY:t})=>{const l=a.inverseCtm.transformPoint({x:e,y:t}),n=O(l.x-c.x,h),o=O(l.y-c.y,h),r=n-i.value.x,d=o-i.value.y;for(const a of s.value)a.x=a.x+r,a.y=a.y+d},b=e=>{u.value=!1,d.value=!1,c.x=null,c.y=null,t.containerRef.removeEventListener("mousemove",g,{passive:!0}),t.containerRef.removeEventListener("mouseup",b,{passive:!0}),t.containerRef.removeEventListener("mouseleave",p,{passive:!0})},f=({offsetX:e,offsetY:l})=>{u.value=!0;const n=a.inverseCtm.transformPoint({x:e,y:l});c.x=n.x-i.value.x,c.y=n.y-i.value.y,c.value=t.containerRef.createSVGPoint(),t.containerRef.addEventListener("mousemove",g,{passive:!0}),t.containerRef.addEventListener("mouseup",b,{passive:!0}),t.containerRef.addEventListener("mouseleave",p,{passive:!0})};return(t,a)=>((0,l.wg)(),(0,l.iD)("svg",{ref_key:"root",ref:o,id:`tablegroup-${e.id}`,class:(0,m.C_)({"db-tablegroup":!0,"db-tablegroup__highlight":d.value,"db-tablegroup__dragging":u.value}),x:(0,n.SU)(i).x,y:(0,n.SU)(i).y,width:(0,n.SU)(i).width,height:(0,n.SU)(i).height,onMouseenterPassive:v,onMouseleavePassive:p},[(0,l._)("rect",{class:"db-tablegroup__background",width:(0,n.SU)(i).width,height:(0,n.SU)(i).height},null,8,de),(0,l._)("g",{class:"db-tablegroup-header",onMousedownPassive:f},[(0,l._)("rect",{height:"30",width:(0,n.SU)(i).width},null,8,ue),(0,l._)("text",ce,(0,m.zw)(e.name),1),(0,l._)("title",null,(0,m.zw)(e.name),1),(0,l._)("line",{x1:"0",y1:"30",y2:"30",x2:(0,n.SU)(i).width,class:"db-tablegroup-header__separator"},null,8,he)],32)],42,re))}},pe=ve,me=pe,ge=["width","height","viewBox"],be={class:"db-chart__bg-grid-small"},fe=["d"],ye=["d"],xe=["width","height","viewBox"],_e=["x","y","width","height"],we={id:"background-layer"},Se=(0,l._)("rect",{class:"db-chart__bg-grid",x:"0",y:"0",width:"100%",height:"100%",fill:"url(#db-chart__bg-grid)"},null,-1),ke={id:"viewport-layer"},Ue={key:0,id:"tablegroups-layer"},Me={key:1,id:"refs-layer"},Pe={key:2,id:"tables-layer"},Ce={key:3,id:"overlays-layer"},qe={id:"tools-layer"},De={x:"10",y:"10",width:"150",height:"36",class:"db-tools"},je=(0,l._)("rect",{class:"db-tools__bg"},null,-1),He=(0,l._)("text",{x:"0",class:"db-tools__header"},"position",-1),$e={x:"0"},Re=(0,l.Uk)("x: "),Ee={x:"75"},Ne=(0,l.Uk)("y: "),Oe={x:"170",y:"10",width:"150",height:"36",class:"db-tools"},Le=(0,l._)("rect",{class:"db-tools__bg"},null,-1),ze=(0,l._)("text",{x:"0",class:"db-tools__header"},"pan",-1),Ae={x:"0"},Ye=(0,l.Uk)("x: "),Te={x:"75"},Ie=(0,l.Uk)("y: "),Ze={x:"330",y:"10",width:"100",height:"36",class:"db-tools"},We=(0,l._)("rect",{class:"db-tools__bg"},null,-1),Fe=(0,l._)("text",{x:"0",class:"db-tools__header"},"zoom",-1),Ge={x:"0"},Be={props:{tableGroups:{type:Array,default:()=>[]},tables:{type:Array,default:()=>[]},refs:{type:Array,default:()=>[]}},emits:["dblclick:table-group","dblclick:table","dblclick:ref","dblclick:field"],setup(e,{emit:t}){const a=e,i=(0,E.g)(),o=(0,n.iH)(null),s=((0,n.iH)(null),(0,n.iH)(null)),r=(0,n.qj)({pattern:{viewport:{x:0,y:0,width:100,height:100},rect:{x:-100,y:-100,width:300,height:300},path:"",x:0,y:0,width:100,height:100},offset:{x:0,y:0}}),d=(0,n.iH)({}),u=(0,n.qj)({x:0,y:0});let c=!1;const h=e=>{const t=i.inverseCtm.transformPoint({x:e.offsetX,y:e.offsetY});u.x=t.x,u.y=t.y},v=()=>{const e=d.value.getSizes(),t=d.value.getPan(),a=d.value.getZoom(),l={x:t.x-e.width/2,y:t.y-e.height/2};i.$patch({pan:l,zoom:a})},p=()=>{d.value.getSizes();const e=i.pan,t=i.zoom,a={x:e.x,y:e.y};d.value.resize(),d.value.center(),d.value.zoom(t),d.value.panBy(a)};function m(e){let t="";const{size:a,divisions:l}=i.grid,n=DOMMatrix.fromMatrix(e),o=n.transformPoint({x:0,y:0}),s=n.transformPoint({x:a,y:a}),d=Math.abs(s.x-o.x),u=Math.abs(s.y-o.y),c=d/l,h=u/l,v=o.x,p=o.y,m=(v%d+d)%d,g=(p%u+u)%u;t+="M 0 0";for(let i=1;i<l;i++)t+=` m ${c*i} 0 l 0 ${u} m -${c*i} -${u}`;t+="M 0 0";for(let i=1;i<l;i++)t+=` m 0 ${h*i} l ${d} 0 m -${d} -${h*i}`;r.pattern.x=-m,r.pattern.y=-g,r.pattern.width=d,r.pattern.height=u,r.pattern.path=t}const g=e=>{i.updateCTM(e),m(e)},b=()=>{v()};function f(e,a){console.log("onRefDblClick",e,a),t("dblclick:ref",e,a)}function y(e,a){console.log("onFieldDblClick",e,a),t("dblclick:field",e,a)}function x(e,a){console.log("onTableDblClick",e,a),t("dblclick:table",e,a)}function _(e,a){console.log("onTableGroupDblClick",e,a),t("dblclick:table-group",e,a)}function w(e){e.target.parentElement.appendChild(e.target)}function S(e){}function k(e){e.target.parentElement.appendChild(e.target)}function U(e){}function M(e){e.target.parentElement.appendChild(e.target)}function P(e){}(0,l.bv)((()=>{d.value=te()(o.value,{viewportSelector:"#viewport-layer",panEnabled:!1,fit:!1,center:!1,dblClickZoomEnabled:!1,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:2}),(0,l.Y3)((()=>{p(),d.value.disablePan(),d.value.setOnPan((()=>v())),d.value.setOnZoom((()=>b())),d.value.setOnUpdatedCTM((e=>g(e)))})),c=!0})),(0,l.YP)((()=>a.tables),(()=>{d.value.updateBBox()})),(0,l.YP)((()=>a.refs),(()=>{d.value.updateBBox()})),(0,l.YP)((()=>i.zoom),(e=>{d.value.zoom(e)}));let C=Date.now(),q=null;function D(e,t,...a){console.log("dblclickHelper",t,...a);const l=Date.now();l-C<500&&q===t.target&&(console.log("dblclickHelperYES",t,...a),e(t,...a)),q=t.target,C=l}return(t,a)=>{const c=(0,l.up)("v-number");return(0,l.wg)(),(0,l.iD)("svg",{ref_key:"root",ref:o,class:"db-chart",onMousemovePassiveCapture:h},[(0,l._)("defs",null,[(0,l._)("pattern",{id:"db-chart__bg-grid-base",width:(0,n.SU)(r).pattern.width,height:(0,n.SU)(r).pattern.height,patternUnits:"userSpaceOnUse",viewBox:`0 0 ${(0,n.SU)(r).pattern.width} ${(0,n.SU)(r).pattern.height}`,class:"db-chart__bg-grid",ref_key:"bgGridRect",ref:s},[(0,l._)("g",be,[(0,l._)("path",{d:(0,n.SU)(r).pattern.path,fill:"none"},null,8,fe)]),(0,l._)("path",{d:`M ${(0,n.SU)(r).pattern.width} 0 L 0 0 0 ${(0,n.SU)(r).pattern.height}`,fill:"none"},null,8,ye)],8,ge),(0,l._)("pattern",{id:"db-chart__bg-grid",x:"0",y:"0",width:(0,n.SU)(r).pattern.width,height:(0,n.SU)(r).pattern.height,patternUnits:"userSpaceOnUse",viewBox:`${(0,n.SU)(r).pattern.x} ${(0,n.SU)(r).pattern.y} ${(0,n.SU)(r).pattern.width} ${(0,n.SU)(r).pattern.height}`},[(0,l._)("rect",{x:`-${(0,n.SU)(r).pattern.width}`,y:`-${(0,n.SU)(r).pattern.height}`,width:""+3*(0,n.SU)(r).pattern.width,height:""+3*(0,n.SU)(r).pattern.height,fill:"url(#db-chart__bg-grid-base)"},null,8,_e)],8,xe)]),(0,l._)("g",we,[(0,l._)("rect",{ref:"bgRef",class:"db-chart__bg",onMousedown:a[0]||(a[0]=e=>d.value.enablePan()),onMouseup:a[1]||(a[1]=e=>d.value.disablePan())},null,544),Se]),(0,l._)("g",ke,[(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.iD)("g",Ue,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.tableGroups,(e=>((0,l.wg)(),(0,l.j4)((0,n.SU)(me),(0,l.dG)({key:e.id},e,{"container-ref":o.value,onClickPassive:t=>D(_,t,e),onMouseenterPassive:M,onMouseleavePassive:P}),null,16,["container-ref","onClickPassive"])))),128))])):(0,l.kq)("",!0),(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.iD)("g",Me,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.refs,(e=>((0,l.wg)(),(0,l.j4)((0,n.SU)(J),(0,l.dG)({key:e.id},e,{"container-ref":o.value,onClickPassive:t=>D(f,t,e),onMouseenterPassive:w,onMouseleavePassive:S}),null,16,["container-ref","onClickPassive"])))),128))])):(0,l.kq)("",!0),(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.iD)("g",Pe,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.tables,(e=>((0,l.wg)(),(0,l.j4)((0,n.SU)(W),(0,l.dG)(e,{key:e.id,"container-ref":o.value,"onClick:header":t=>D(x,t,e),"onClick:field":a[2]||(a[2]=(...e)=>D(y,...e)),onMouseenterPassive:k,onMouseleavePassive:U}),null,16,["container-ref","onClick:header"])))),128))])):(0,l.kq)("",!0),(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.iD)("g",Ce,[(0,l.Wm)((0,n.SU)(se))])):(0,l.kq)("",!0)]),(0,l._)("g",qe,[((0,l.wg)(),(0,l.iD)("svg",De,[je,He,(0,l._)("text",$e,[Re,(0,l.Wm)(c,{value:(0,n.SU)(u).x,decimals:"1"},null,8,["value"])]),(0,l._)("text",Ee,[Ne,(0,l.Wm)(c,{value:(0,n.SU)(u).y,decimals:"1"},null,8,["value"])])])),((0,l.wg)(),(0,l.iD)("svg",Oe,[Le,ze,(0,l._)("text",Ae,[Ye,(0,l.Wm)(c,{value:(0,n.SU)(i).pan.x,decimals:"1"},null,8,["value"])]),(0,l._)("text",Te,[Ie,(0,l.Wm)(c,{value:(0,n.SU)(i).pan.y,decimals:"1"},null,8,["value"])])])),((0,l.wg)(),(0,l.iD)("svg",Ze,[We,Fe,(0,l._)("text",Ge,[(0,l.Wm)(c,{value:(0,n.SU)(i).zoom,decimals:"3"},null,8,["value"])])]))])],544)}}},Qe=Be,Ve=Qe;a(8423);const Xe={props:{database:Object},setup(e){const t=e,a=(0,l.Fl)((()=>{const e=t.database;return e.schemas.map((e=>({id:`schema-${e.id}`,icon:"schema",label:e.name,children:[{id:`schema-${e.id}-tables`,icon:"source",label:"Tables",children:e.tables.map((e=>({id:`table-${e.id}`,icon:"table-view",label:e.name,children:[{id:`table-${e.id}-fields`,icon:"",label:"Columns",children:e.fields.map((e=>({id:`field-${e.id}`,icon:"",label:e.name})))}]})))}]})))}));return(e,t)=>{const i=(0,l.up)("q-tree");return(0,l.wg)(),(0,l.j4)(i,{"node-key":"id",nodes:(0,n.SU)(a),dense:""},null,8,["nodes"])}}};var Ke=a(756);H()(Xe,"components",{QTree:Ke.Z});const Je={class:"dbml-graph-wrapper"},et={class:"dbml-toolbar-wrapper"},tt=(0,l.Uk)(" Auto-Layout "),at=(0,l.Uk)(" fit "),lt={class:"q-mx-sm non-selectable",style:{width:"2.5rem",flex:"0 0 auto"}},nt={props:{schema:{type:Object,required:!0}},emits:["update:positions"],setup(e,{emit:t}){const a=(0,r.E)(),i=(0,E.g)(),o=(e,t)=>{if(console.log("locateInEditor",e,t),t){const e=t.token;a.updateSelectionMarker(e.start,e.end)}},s=(0,l.Fl)({get(){return 100*(i.zoom||1)},set(e){i.updateZoom(e/100)}}),d=(0,n.iH)(10),u=(0,n.iH)(200),c=()=>{},h=()=>{};return(t,a)=>{const r=(0,l.up)("q-card"),v=(0,l.up)("q-btn"),p=(0,l.up)("q-space"),g=(0,l.up)("q-slider"),b=(0,l.up)("q-toolbar");return(0,l.wg)(),(0,l.iD)("div",Je,[e.schema&&(0,n.SU)(i).loaded?((0,l.wg)(),(0,l.j4)((0,n.SU)(Ve),(0,l.dG)({key:0},e.schema,{"onDblclick:tableGroup":o,"onDblclick:table":o,"onDblclick:field":o,"onDblclick:ref":o}),null,16)):(0,l.kq)("",!0),(0,l.kq)("",!0),(0,l._)("div",et,[(0,l.Wm)(r,{class:"shadow-6"},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{class:"rounded-borders"},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{class:"q-mr-xs q-px-md",color:"secondary",dense:"",onClick:c},{default:(0,l.w5)((()=>[tt])),_:1}),(0,l.Wm)(v,{class:"q-mx-xs q-px-md",color:"secondary",dense:"",onClick:h},{default:(0,l.w5)((()=>[at])),_:1}),(0,l.Wm)(p),(0,l.Wm)(g,{class:"q-mx-sm",style:{width:"25%","min-width":"100px","max-width":"200px"},modelValue:(0,n.SU)(s),"onUpdate:modelValue":a[0]||(a[0]=e=>(0,n.dq)(s)?s.value=e:null),min:d.value,max:u.value},null,8,["modelValue","min","max"]),(0,l._)("div",lt,(0,m.zw)(Math.round((0,n.SU)(s)))+" % ",1)])),_:1})])),_:1})])])}}};var it=a(1663),ot=a(8879),st=a(136),rt=a(4278);const dt=(0,h.Z)(nt,[["__scopeId","data-v-6a5a3022"]]),ut=dt;H()(nt,"components",{QCard:ie.Z,QToolbar:it.Z,QBtn:ot.Z,QSpace:st.Z,QSlider:rt.Z});var ct=a(9302);const ht={setup(e){const t=(0,n.iH)(null),a=(0,r.E)(),i=((0,ct.Z)(),(0,l.Fl)({get:()=>a.getSourceText,set:e=>a.updateSourceText(e)})),o=((0,l.Fl)({get:()=>a.getPreferences,set:e=>a.updatePreferences(e)}),(0,l.Fl)({get:()=>a.getSplit,set:e=>a.updateSplit(e)})),s=(0,l.Fl)((()=>{var e,t;return null===(e=a.getDatabase)||void 0===e||null===(t=e.schemas)||void 0===t?void 0:t.find((e=>!0))}));return(e,a)=>{const r=(0,l.up)("q-splitter"),d=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(d,null,{default:(0,l.w5)((()=>[(0,l.Wm)(r,{modelValue:(0,n.SU)(o),"onUpdate:modelValue":a[1]||(a[1]=e=>(0,n.dq)(o)?o.value=e:null),limits:[10,75],class:"editor-wrapper"},{before:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(p),{ref_key:"editorRef",ref:t,class:"db-code-editor",source:(0,n.SU)(i),"onUpdate:source":a[0]||(a[0]=e=>(0,n.dq)(i)?i.value=e:null)},null,8,["source"])])),after:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(ut),{class:"db-graph-view",schema:(0,n.SU)(s)},null,8,["schema"])])),_:1},8,["modelValue"])])),_:1})}}};var vt=a(9885),pt=a(7498);const mt=(0,h.Z)(ht,[["__scopeId","data-v-a939e2d0"]]),gt=mt;H()(ht,"components",{QPage:vt.Z,QSplitter:pt.Z})}}]);